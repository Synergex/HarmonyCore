;;*****************************************************************************
;;
;; Title:       SelfHost.dbl
;;
;; Description: A program to self-host Harmony Core services
;;
;;*****************************************************************************
;; WARNING: GENERATED CODE!
;; This file was generated by CodeGen. Avoid editing the file if possible.
;; Any changes you make will be lost of the file is re-generated.
;;*****************************************************************************

import Microsoft.AspNetCore
import Microsoft.AspNetCore.Hosting
import Microsoft.AspNetCore.TestHost
import System.IO
import Services
import Services.Test.UnitTests
import Services.Test

main SelfHost

proc
    ;;Configure the environment
    UnitTestEnvironment.AssemblyInitialize(^null)

    ;Leave this here for Jeff 
    ;data tester = new OrderTests()  
    ;tester.GetOrders_Expand_REL_TagCustomer() 
    ;tester.GetOrders_Expand_REL_TagVendor()
    ;tester.GetOrders_Expand_All()
    ;tester.GetCustomer()      

    Console.WriteLine("API documentation is available at https://localhost:8086/api-docs")

    data wwwroot = Path.Combine(AppContext.BaseDirectory, "wwwroot")

    ;;Make sure the wwwroot folder is present
    if (!Directory.Exists(wwwroot))
        Directory.CreateDirectory(wwwroot)

    ;;Start self-hosting (Kestrel)
    WebHost.CreateDefaultBuilder(new string[0])
    &    .UseContentRoot(wwwroot)
    &    .UseWebRoot(wwwroot)
    &    .UseStartup<Startup>()
    &    .UseUrls("http://localhost:8085", "https://localhost:8086")
    &    .Build()
    &    .Run()

    ;;Cleanup the environment
    UnitTestEnvironment.AssemblyCleanup()

endmain