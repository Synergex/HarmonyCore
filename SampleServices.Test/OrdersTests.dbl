import System
import System.Collections.Generic
import System.Text
import Microsoft.VisualStudio.TestTools.UnitTesting
import System.Threading.Tasks
import Microsoft.AspNetCore.Hosting
import Microsoft.AspNetCore.TestHost
import Microsoft.AspNet.OData
import Microsoft.AspNetCore.Builder
import Microsoft.AspNet.OData.Routing
import Microsoft.AspNetCore.Mvc
import Microsoft.EntityFrameworkCore
import Microsoft.Extensions.DependencyInjection
import Microsoft.Extensions.Configuration
import Microsoft.AspNet.OData.Extensions
import Microsoft.AspNet.OData.Builder
import Microsoft.OData.Edm
import Microsoft.OData
import Harmony.Core
import Harmony.Core.Utility
import Harmony.Core.Context
import Harmony.Core.FileIO
import Harmony.Core.FileIO.Queryable
import System.Linq
import System.Net.Http
import Harmony.AspNetCore.Context

namespace SampleServices.Test

	{TestClass}
	public class OrdersTests

		server, @TestServer 

		public method OrdersTests
		proc
			Encoding.RegisterProvider(CodePagesEncodingProvider.Instance)

			data status, i4
			setlog("ICSTUT", EnvironmentRootBuilder.FindRelativeFolderForAssembly("SampleData"), status)
			server = new TestServer(new WebHostBuilder().UseStartup<Startup>())
		endmethod

		{TestMethod}
		public method GetAllOrders, void
		proc
			data client = server.CreateClient()
			data request = "/odata/Orders"
			data response = client.GetAsync(request).Result
			data result = response.Content.ReadAsStringAsync().Result

			Console.WriteLine(result)

			response.EnsureSuccessStatusCode()

		endmethod
	
		{TestMethod}
		public method GetOrder9013, void
		proc
			data client = server.CreateClient()
			data request = "/odata/Orders(9013)"
			data response = client.GetAsync(request).Result
			data result = response.Content.ReadAsStringAsync().Result

			Console.WriteLine(result)

			throw new exception()

			response.EnsureSuccessStatusCode()

		endmethod
	
	endclass

endnamespace

main
proc
endmain